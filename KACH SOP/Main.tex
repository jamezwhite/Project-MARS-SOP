%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Preamble %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[]{report}

\usepackage{titling}               % Adds control for typestting of the \maketitle command
\usepackage{newtxtext}
\usepackage{fancyhdr}              % Gives Control over headers and footers
\usepackage{acro}                  % Adds Acronym Glossing and Appendix
\usepackage[section=section]{glossaries}            % Adds Term Glossing and Appendix
\usepackage{blindtext}             % Creates Lorem Ipsum when asked for
\usepackage{titlesec}              % Allows for Alternative Section Titles
\usepackage{graphicx}              % Allows for image use
\usepackage[titletoc]{appendix}    % Gives extra control of appendices
\usepackage[
  letterpaper,
  margin=1in,          % set all margins; tweak to taste (e.g., 0.8in)
  includeheadfoot,     % count header & footer space inside the margins
  headheight=14pt,     % matches your fancyhdr header content height
  headsep=10pt,        % space between header and text
  footskip=24pt        % space from bottom of text to baseline of footer
]{geometry}                        %Flexible and Complete Interface to Document Dimensions
\usepackage[hidelinks]{hyperref}
\usepackage{cleveref}              %Allows for intelligent crossreferencing
\usepackage{pdfcomment}            % Allows for Tooltips in PDF
\usepackage{enumitem}              % for tidy list spacing (optional)


\renewcommand{\familydefault}{\sfdefault} % Use sans-serif font

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Header/Footer Formatting %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{fancy} % use fancyhdr package to customize headers/footers
\fancyhf{} % clear all header and footer fields

% Expose the date you set for the title page so we can reuse it in the footer
\makeatletter
\newcommand{\frontpagedate}{\@date} % this will mirror whatever you put in \date{...}
\makeatother

% Put ONLY the chapter title (not "Chapter 1") in the running header mark
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}

% --- Header: top-left shows chapter title on non-opening pages
\fancyhead[L]{\nouppercase{\leftmark}}

% --- Footer: left = fixed text + front-page date, right = page number
\fancyfoot[L]{Project MARS SOP, \thedate}
\fancyfoot[R]{\thepage}

% Optional rules (lines). Header rule on; footer rule off.
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% Make chapter opening pages use a blank header but keep the same footer
% (report class sets chapter openings to \thispagestyle{plain} by default)
\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[L]{Project MARS SOP, \thedate}%
  \fancyfoot[R]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}%
}

% Prevent the classic "Package Fancyhdr Warning: \headheight is too small"
\setlength{\headheight}{14pt} % bump if you add taller content

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Acronym Setup and Tooltips %%%%%%%%%%%%%%%%%%%%%%%%%%%
% Load all acronyms from source file
\input{KACH SOP/ABCA}  

% Redefine commands after everything is loaded to turn on tooltips
\AtBeginDocument{%
    \let\oldac\ac
    \renewcommand{\ac}[1]{%
        \pdftooltip{\oldac{#1}}{\acl{#1}}%
    }%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Term Setup and Tooltips %%%%%%%%%%%%%%%%%%%%%%%%%%%
% Load all acronyms from source file
\makenoidxglossaries
\input{KACH SOP/Terms}  

\AtBeginDocument{%
  % Show tooltip with the entry's description when hovering the term
  \NewDocumentCommand{\term}{m}{\pdftooltip{\gls{#1}}{\glsentrydesc{#1}}}
  \NewDocumentCommand{\Term}{m}{\pdftooltip{\Gls{#1}}{\glsentrydesc{#1}}}
  \NewDocumentCommand{\terms}{m}{\pdftooltip{\glspl{#1}}{\glsentrydesc{#1}}}
  \NewDocumentCommand{\Terms}{m}{\pdftooltip{\Glspl{#1}}{\glsentrydesc{#1}}}
}

\newglossarystyle{termabove}{%
  \setglossarystyle{list}% start from the basic list style
  \renewenvironment{theglossary}%
    {\begin{description}[leftmargin=0pt,labelsep=0pt,itemsep=.6\baselineskip]}%
    {\end{description}}%
  \renewcommand*{\glossentry}[2]{%
    \item[]%
      \glstarget{##1}{\textbf{\glsentryname{##1}}}\par
      \glossentrydesc{##1}\glspostdescription\space ##2%
  }%
  \renewcommand*{\glsgroupskip}{}% suppress A/B/C group headings
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Reference  Formatting %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\crefformat{chapter}{Chapter~#2#1 (\descriptionlabel{#1})#3}
\Crefformat{chapter}{Chapter~#2#1 (\descriptionlabel{#1})#3}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Paragraph Numbering %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Your existing counter setup (keep as-is)
\setcounter{secnumdepth}{5}
\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thesection}{\thechapter-\arabic{section}}

\makeatletter
\@addtoreset{paragraph}{section}
\@addtoreset{subparagraph}{paragraph}
\makeatother

\renewcommand{\theparagraph}{\alph{paragraph}}
\renewcommand{\thesubparagraph}{(\arabic{subparagraph})}

% Modified paragraph formatting with hanging indent
\titleformat{\paragraph}[runin]
  {\normalfont\normalsize}%
  {\textit{\theparagraph.}}{0.75em}{\bfseries}[\normalfont]

\titleformat{\subparagraph}[runin]
  {\normalfont\normalsize}%
  {\thesubparagraph}{0.75em}{\underline}[\normalfont]

% Modified spacing with hanging indent control
\titlespacing*{\paragraph}{1em}{0.5\baselineskip}{0.75em}
\titlespacing*{\subparagraph}{2em}{0pt}{0.75em} % Indent subparagraphs

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Document Information %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Project MARS - Standard Operating Procedure}
\author{SFC Jamez White, Project NCOIC}
\date{01 Dec 2025}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Document Content %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\include{KACH SOP/frontpage}

\tableofcontents
\listoffigures
\listoftables

\include{General}
\include{Roles and Responsibilities}
\include{Airframe and Supporting Systems}
\include{Pilot Certification}
\include{Flight Operations}
\include{Maintenance}
\include{Safety}

\begin{appendices}
\include{References}
\include{Checklists}
\include{Forms}
\include{KACH SOP/uas characteristics}
\end{appendices}
\include{glossary.tex}
\end{document}
